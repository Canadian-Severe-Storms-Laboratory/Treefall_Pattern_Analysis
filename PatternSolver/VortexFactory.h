#pragma once
#include <random>
#include <memory>
#include "LinearPiecewiseVortex.h"
#include "BakerSterlingVortex.h"
#include "BurgersRottVortex.h"
#include "SullivanVortex.h"
#include "BurgersRottRRVortex.h"
#include "SullivanRRVortex.h"
#include "ModifiedRankineVortex.h"
#include "CPP_CS_Interop.h"


EXPORT class VortexFactory
{
public:

	static std::unique_ptr<VortexModel> randomModel(std::vector<double>& models, std::uniform_real_distribution<double>& dist, std::mt19937& gen) {
	
		int choice = (int)models[(int)(dist(gen) * models.size())];

		switch (choice)
		{
			case 1:
				return std::unique_ptr<VortexModel>(new BakerSterlingVortex());
			case 2:
				return std::unique_ptr<VortexModel>(new BurgersRottVortex());
			case 3:
				return std::unique_ptr<VortexModel>(new SullivanVortex());
			case 4:
				return std::unique_ptr<VortexModel>(new BurgersRottRRVortex());
			case 5:
				return std::unique_ptr<VortexModel>(new SullivanRRVortex());
			default:
				const double phi = 0.25 * dist(gen) + 0.5;
				return std::unique_ptr<VortexModel>(new ModifiedRankineVortex(phi));
		}
	}

	static std::unique_ptr<VortexModel> fromIndex(int index, double Vr, double Vt, double Vs) {
		switch (index)
		{
			case 1:
				return std::unique_ptr<VortexModel>(new BakerSterlingVortex(Vr, Vt, Vs));
			case 2:
				return std::unique_ptr<VortexModel>(new BurgersRottVortex(Vr, Vt, Vs));
			case 3:
				return std::unique_ptr<VortexModel>(new SullivanVortex(Vr, Vt, Vs));
			case 4:
				return std::unique_ptr<VortexModel>(new BurgersRottRRVortex(Vr, Vt, Vs));
			case 5:
				return std::unique_ptr<VortexModel>(new SullivanRRVortex(Vr, Vt, Vs));
			default:
				return std::unique_ptr<VortexModel>(new ModifiedRankineVortex(0.5, Vr, Vt, Vs));
		}
	}

	static LinearPiecewiseVortex bakerSterlingLPVortex(double Vr, double Vt, double Vs) {

		return LinearPiecewiseVortex(SplineTable({ { 0.268689, 1.898414, 0.000000, 1.898414, 0.000000 },
												   { 0.491592, 1.303857, 0.159751, 1.303857, 0.159751 },
												   { 0.731630, 0.671810, 0.470460, 0.671810, 0.470460 },
												   { 1.000000, 0.141683, 0.858317, 0.141683, 0.858317 },
												   { 1.409418, -0.117645, 1.117645, -0.117645, 1.117645 },
												   { 2.588731, -0.243813, 1.295469, -0.243813, 1.295469 },
												   { 4.017329, -0.142425, 1.033003, -0.142425, 1.033003 },
												   { 6.320819, -0.069506, 0.740064, -0.069506, 0.740064 },
												   { 10.00000, -0.027916, 0.477176, -0.027916, 0.477176 } }), 
												   Vr, Vt, Vs);
	}

	static LinearPiecewiseVortex burgersRottLPVortex(double Vr, double Vt, double Vs) {

		return LinearPiecewiseVortex(SplineTable({  { 0.309114, 1.680177, 0.000000, 1.680177, 0.000000 },
													{ 0.547995, 1.214656, 0.143899, 1.214656, 0.143899 },
													{ 0.778553, 0.674021, 0.440164, 0.674021, 0.440164 },
													{ 1.000000, 0.158390, 0.841610, 0.158390, 0.841610 },
													{ 1.250197, -0.130572, 1.130573, -0.130572, 1.130573 },
													{ 2.166717, -0.360016, 1.417423, -0.360016, 1.417423 },
													{ 2.938291, -0.217299, 1.108195, -0.217299, 1.108195 },
													{ 4.160020, -0.114360, 0.805729, -0.114360, 0.805729 },
													{ 6.337920, -0.053021, 0.550559, -0.053021, 0.550559 },
													{ 10.00000, -0.020404, 0.343831, -0.020404, 0.343831 } }),
													Vr, Vt, Vs);
	}

	static LinearPiecewiseVortex sullivanLPVortex(double Vr, double Vt, double Vs) {

		return LinearPiecewiseVortex(SplineTable({  { 0.269446, 0.260465, 0.000000, 0.260465, 0.000000 },
													{ 0.429493, 0.828407, -0.153030, 0.828407, -0.153030 },
													{ 0.579265, 1.601919, -0.485248, 1.601919, -0.485248 },
													{ 0.766860, 2.008775, -0.720925, 2.008775, -0.720925 },
													{ 0.889796, 1.209612, -0.108079, 1.209612, -0.108079 },
													{ 1.000000, 0.288296, 0.711704, 0.288296, 0.711704 },
													{ 1.174934, -0.292192, 1.292192, -0.292192, 1.292192 },
													{ 1.581133, -0.593462, 1.646164, -0.593462, 1.646164 },
													{ 2.217543, -0.323001, 1.218529, -0.323001, 1.218529 },
													{ 3.330655, -0.153398, 0.842429, -0.153398, 0.842429 },
													{ 5.553167, -0.061256, 0.535534, -0.061256, 0.535534 },
													{ 10.00000, -0.018456, 0.297862, -0.018456, 0.297862 } }),
													Vr, Vt, Vs);
	}


	static LinearPiecewiseVortex modifiedRankineLPVortex(double phi, double Vr, double Vt, double Vs) {
	
		int p = (int)round(phi * 100);

		switch (p) {
			case 100:
				return LinearPiecewiseVortex(SplineTable({  { 1.000000, 1.000000, 0.000000, 1.000000, 0.000000 },
															{ 1.237596, -0.838090, 1.838090, -0.838090, 1.838090 },
															{ 1.646364, -0.490789, 1.408272, -0.490789, 1.408272 },
															{ 2.296950, -0.264437, 1.035614, -0.264437, 1.035614 },
															{ 3.425826, -0.127082, 0.720115, -0.127082, 0.720115 },
															{ 5.649065, -0.051672, 0.461776, -0.051672, 0.461776 },
															{ 10.000000, -0.016060, 0.260599, -0.016060, 0.260599 } }),
															Vr, Vt, Vs);
				
			case 95:
				return LinearPiecewiseVortex(SplineTable({  { 0.252908, 1.086561, 0.000000, 1.086561, 0.000000 },
															{ 1.000000, 0.970697, 0.029303, 0.970697, 0.029303 },
															{ 1.243489, -0.796497, 1.796497, -0.796497, 1.796497 },
															{ 1.662936, -0.467676, 1.387612, -0.467676, 1.387612 },
															{ 2.330103, -0.253500, 1.031451, -0.253500, 1.031451 },
															{ 3.482705, -0.123276, 0.728016, -0.123276, 0.728016 },
															{ 5.725883, -0.051289, 0.477305, -0.051289, 0.477305 },
															{ 10.000000, -0.016712, 0.279321, -0.016712, 0.279321 } }),
															Vr, Vt, Vs);
				
			case 90:
				return LinearPiecewiseVortex(SplineTable({  { 0.235995, 1.189718, 0.000000, 1.189718, 0.000000 },
															{ 1.000000, 0.941398, 0.058602, 0.941398, 0.058602 },
															{ 1.313019, -0.725920, 1.725920, -0.725920, 1.725920 },
															{ 1.906490, -0.375997, 1.266465, -0.375997, 1.266465 },
															{ 2.985276, -0.172225, 0.877974, -0.172225, 0.877974 },
															{ 5.239183, -0.065860, 0.560447, -0.065860, 0.560447 },
															{ 10.000000, -0.018799, 0.313886, -0.018799, 0.313886 } }),
															Vr, Vt, Vs);
				
			case 85:
				return LinearPiecewiseVortex(SplineTable({  { 0.079445, 1.529738, 0.000000, 1.529738, 0.000000 },
															{ 0.427104, 1.061605, 0.037191, 1.061605, 0.037191 },
															{ 1.000000, 0.889155, 0.110845, 0.889155, 0.110845 },
															{ 1.321011, -0.686066, 1.686066, -0.686066, 1.686066 },
															{ 1.930201, -0.357008, 1.251377, -0.357008, 1.251377 },
															{ 3.034312, -0.165313, 0.881367, -0.165313, 0.881367 },
															{ 5.315485, -0.064687, 0.576036, -0.064687, 0.576036 },
															{ 10.000000, -0.019413, 0.335385, -0.019413, 0.335385 } }),
															Vr, Vt, Vs);
				
			case 80:
				return LinearPiecewiseVortex(SplineTable({  { 0.068909, 1.816600, 0.000000, 1.816600, 0.000000 },
															{ 0.406542, 1.093104, 0.049856, 1.093104, 0.049856 },
															{ 1.000000, 0.852212, 0.147788, 0.852212, 0.147788 },
															{ 1.329286, -0.646226, 1.646226, -0.646226, 1.646226 },
															{ 1.954673, -0.337987, 1.236489, -0.337987, 1.236489 },
															{ 3.084439, -0.158312, 0.885282, -0.158312, 0.885282 },
															{ 5.391741, -0.063424, 0.592606, -0.063424, 0.592606 },
															{ 10.000000, -0.019997, 0.358460, -0.019997, 0.358460 } }),
															Vr, Vt, Vs);
				
			case 75:
				return LinearPiecewiseVortex(SplineTable({  { 0.058730, 2.200008, 0.000000, 2.200008, 0.000000 },
															{ 0.384592, 1.132597, 0.062689, 1.132597, 0.062689 },
															{ 1.000000, 0.815270, 0.184730, 0.815270, 0.184730 },
															{ 1.337858, -0.606393, 1.606393, -0.606393, 1.606393 },
															{ 1.979932, -0.318911, 1.221783, -0.318911, 1.221783 },
															{ 3.135669, -0.151194, 0.889715, -0.151194, 0.889715 },
															{ 5.467945, -0.062049, 0.610187, -0.062049, 0.610187 },
															{ 10.000000, -0.020537, 0.383201, -0.020537, 0.383201 } }),
															Vr, Vt, Vs);
				
			case 70:
				return LinearPiecewiseVortex(SplineTable({  { 0.021101, 3.511986, 0.000000, 3.511986, 0.000000 },
															{ 0.155500, 1.522565, 0.041979, 1.522565, 0.041979 },
															{ 0.489437, 1.002177, 0.122900, 1.002177, 0.122900 },
															{ 1.000000, 0.757200, 0.242800, 0.757200, 0.242800 },
															{ 1.346738, -0.566556, 1.566556, -0.566556, 1.566556 },
															{ 2.005997, -0.299753, 1.207243, -0.299753, 1.207243 },
															{ 3.187989, -0.143930, 0.894662, -0.143930, 0.894662 },
															{ 5.544020, -0.060540, 0.628815, -0.060540, 0.628815 },
															{ 10.000000, -0.021017, 0.409700, -0.021017, 0.409700 } }),
															Vr, Vt, Vs);
				
			case 65:
				return LinearPiecewiseVortex(SplineTable({  { 0.016176, 4.769590, 0.000000, 4.769590, 0.000000 },
															{ 0.136413, 1.708529, 0.049516, 1.708529, 0.049516 },
															{ 0.464892, 1.016458, 0.143924, 1.016458, 0.143924 },
															{ 1.000000, 0.716740, 0.283260, 0.716740, 0.283260 },
															{ 1.355940, -0.526706, 1.526706, -0.526706, 1.526706 },
															{ 2.032889, -0.280486, 1.192846, -0.280486, 1.192846 },
															{ 3.241388, -0.136489, 0.900117, -0.136489, 0.900117 },
															{ 5.619906, -0.058868, 0.648517, -0.058868, 0.648517 },
															{ 10.000000, -0.021418, 0.438050, -0.021418, 0.438050 } }),
															Vr, Vt, Vs);
				
			case 60:
				return LinearPiecewiseVortex(SplineTable({  { 0.010000, 5.496091, 0.000000, 5.496091, 0.000000 },
															{ 0.032500, 3.606680, 0.018894, 3.606680, 0.018894 },
															{ 0.165573, 1.592787, 0.084346, 1.592787, 0.084346 },
															{ 0.487145, 0.962740, 0.188664, 0.962740, 0.188664 },
															{ 1.000000, 0.683383, 0.324752, 0.683383, 0.324752 },
															{ 1.365470, -0.486832, 1.486832, -0.486832, 1.486832 },
															{ 2.060613, -0.261078, 1.178572, -0.261078, 1.178572 },
															{ 3.295810, -0.128836, 0.906071, -0.128836, 0.906071 },
															{ 5.695427, -0.057004, 0.669328, -0.057004, 0.669328 },
															{ 10.000000, -0.021716, 0.468345, -0.021716, 0.468345 } }),
															Vr, Vt, Vs);
				
			case 55:
				return LinearPiecewiseVortex(SplineTable({  { 0.010000, 7.252853, 0.000000, 7.252853, 0.000000 },
															{ 0.027778, 4.145738, 0.031071, 4.145738, 0.031071 },
															{ 0.121437, 1.860847, 0.094541, 1.860847, 0.094541 },
															{ 0.343291, 1.089899, 0.188163, 1.089899, 0.188163 },
															{ 0.767766, 0.728688, 0.312163, 0.728688, 0.312163 },
															{ 1.000000, 0.552783, 0.447217, 0.552783, 0.447217 },
															{ 1.375345, -0.446919, 1.446919, -0.446919, 1.446919 },
															{ 2.089193, -0.241495, 1.164390, -0.241495, 1.164390 },
															{ 3.351255, -0.120929, 0.912505, -0.120929, 0.912505 },
															{ 5.770579, -0.054912, 0.691264, -0.054912, 0.691264 },
															{ 10.000000, -0.021883, 0.500667, -0.021883, 0.500667 } }),
															Vr, Vt, Vs);
				
			default:
				return LinearPiecewiseVortex(SplineTable({  { 0.010000, 10.887644, 0.000000, 10.887644, 0.000000 },
															{ 0.067524, 2.778910, 0.081087, 2.778910, 0.081087 },
															{ 0.240803, 1.332320, 0.178766, 1.332320, 0.178766 },
															{ 0.628200, 0.779236, 0.311951, 0.779236, 0.311951 },
															{ 1.000000, 0.533978, 0.466022, 0.533978, 0.466022 },
															{ 1.385578, -0.406955, 1.406955, -0.406955, 1.406955 },
															{ 2.118654, -0.221696, 1.150265, -0.221696, 1.150265 },
															{ 3.407718, -0.112725, 0.919391, -0.112725, 0.919391 },
															{ 5.845348, -0.052550, 0.714334, -0.052550, 0.714334 },
															{ 10.000000, -0.021887, 0.535095, -0.021887, 0.535095 } }),
															Vr, Vt, Vs);
		}
	
	}
};